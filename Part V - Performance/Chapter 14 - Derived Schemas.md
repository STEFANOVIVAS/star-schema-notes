# Chapter 14 - Derived Schemas

- Performance is one of the foundational principles of data warehousing in general.
- By restructuring data at load time, rather than query time, answering analytic questions about business processes is faster and easier.
- Derived schemas store copies of existing dimensional data that has been restructured.
- These data structures can improve query performance and reduce report development complexity, at the cost of additional work loading and managing them.
- Besides some derived structures that have already been studied in this book, we have four more to know:  
    - Merged fact tables  
    - Pivoted fact tables
    - Sliced fact tables
    - Set operation fact tables
 
## Restructuring Dimensional Data
- Derived schemas provide a second layer to the dimensional architecture. They piggyback on existing dimensional structures, rather than drawing data from the original sources.
- Other examples of derived schemas: snapshots, accumulating snapshots, and core fact tables.
- By restructuring data, a derived schema makes answers accessible to users of less skill, and may also reduce report development costs.
- Benefits are achieved by moving work out of the query and reporting process and into the ETL process, as more tables must be designed, loaded, and maintained. 

### Uses for Derived Schemas
- Derived schemas can improve query performance and reduce report complexity.
- A derived schema can be used to produce a replica of the base schema that is limited in scope (Controls the size of data sets and allows for the application of role-based security)
- Very handy when deploying OLAP cubes for analytic purposes.
  
## The Merged Fact Table
- It is the most common form of derived schema and consolidates facts from one or more stars in a single fact table. The resulting star can be used to perform cross-process analysis.  
- For this reason, the merged fact table may also be referred to as a drill-across fact table or consolidated fact table.  
- A common use of the merged fact table supports the comparison of plans or goals to actual performance.
- Profitability analysis is a common example where a merged fact table can provide significant performance improvements. Studying profitability requires the comparison of revenue and costs, which are generated by separate processes represented by separate stars. Bringing together more components can create a finer picture of profitability but also impacts performance.
- When comparing facts from two or more stars, it is often necessary to filter one of the stars using a dimension that is not shared. It may be omitted from the merged star, which will limit analytic possibilities, or it may be included in the merged star, which will require that every query constrain on the dimension in question.

  ![Merged fact tables](https://github.com/STEFANOVIVAS/star-schema-notes/blob/main/images/merged_fact_table.png)

## The Pivoted Fact Table
- In this case, data from the original fact table is transposed from a row-wise to column-wise orientation, or vice versa. 
- Performance is generally only marginally improved, so the pivoted fact table is generally saved for report-heavy applications, where it can save a significant amount of report development time.
- The relatively small effort required to do so within a report may not justify the additional burden of loading and maintaining an additional star. The value of a pivoted schema increases as the number of rows to be transposed into columns increases.
  
## The Sliced Fact Table
- A sliced fact table is exactly the same as the original star but only contains a subset of rows.
- Sliced fact tables are typically defined using a specific dimension attribute and may be useful in providing distributed applications, enforcing role-based security, or in reducing schema scope for use in an OLAP tool.
- The most common uses involve a regional or departmental focus, as in the example. Slices limit the size and scope of the data set without sacrificing detail.

## Set Operation Fact Tables
- The last form of derived fact table takes two stars as an input and produces an output based on the application of set operations or the use of a subquery or correlated subquery.
- The resulting star provides performance advantages over the original schema, avoiding the use of set operators at query time.
- Example: Identification of sales assignments that are nonproductive involves comparing order facts with sales assignments. One way to perform this comparison leverages set operations. The set of salesperson/customer assignments for a period, minus the set of salesperson/customer orders for the period, yields nonproductive assignments.
